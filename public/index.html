<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="styles.css">
        <title>Small World finder</title>
    <div>
        <img class="logo" src="logo.png">
    </div>
    <h4 class="center"> einfach Zitationen suchen </h4>
    <p>RevieWanted ist ein Tool, welches Forschern das mühsame Suchen von zitierten Artikel erleichtert. Als Vorbereitung setzt die Webseite eine Liste von Artikel (PMIDs) oder einen gewünschten Scuhterm (Advanced PubMed Query)</p>
    <br>
    <!-- Fileupload -->
    
    <p>
        <label> a) Laden Sie ein Liste von PMIDs oder ein CSV hoch:</label>
        <br>
        <input type="file" id="dateien" name="files[]" multiple />
        <button id="btnsend" onclick="search()" class="buttonUpload" role="button">Suchen</button>
    </p>
    </head>
    <body>
        <br>
        <br>
            <label>b) PubMed (Advanced) Searchquery: </label>
        <br>
        <div>
            <input type="text" id="sterm" class="inputsearch" name="search" value="tractor accidents"/>
            <button id="btnsend" onclick="search()" class="buttonupdata" role="button">Suchen</button>
        </div>
        <br>
        <button id="filter-button" class="btn_fi_send">Attribute</button>
        <!-- Filter (Parameter) Button -->
        <div id="filter-container" class="filters">
           <ul class="filters__list">
               <li>
                   <input id="f1" type="checkbox" />
                   <label for="f1">PMID</label>
               </li>
               <li>
                   <input id="f2" type="checkbox" />
                   <label for="f2">Autoren</label>
               </li>
               <li>
                   <input id="f3" type="checkbox" />
                   <label for="f3">Journal</label>
               </li>
               <li>
                   <input id="f4" type="checkbox" />
                   <label for="f4">is_research_art</label>
                </li>
                <li>
                    <input id="f5" type="checkbox" />
                    <label for="f5">rCr</label>
                </li>
                <li>
                    <input id="f6" type="checkbox" />
                    <label for="f6">nih percentile</label>
                </li>
                <li>
                    <input id="f7" type="checkbox" />
                    <label for="f7">animal</label>
                </li><li>
                    <input id="f8" type="checkbox" />
                    <label for="f8">citation count</label>
                </li>
                <li>
                    <input id="f9" type="checkbox" />
                    <label for="f9">expected citations / year</label>
                </li>
                <li>
                    <input id="f10" type="checkbox" />
                    <label for="f10">field citation rate</label>
                </li>
                <li>
                    <input id="f11" type="checkbox" />
                    <label for="f11">cited by clin</label>
                </li>
                <li>
                    <input id="f11" type="checkbox" />
                    <label for="f11">cited by</label>
                </li>
                <li>
                    <input id="f12" type="checkbox" />
                    <label for="f12">references</label>
                </li>
                <li>
                    <button id="applyfilter" class="filter-btn"> Filter anwenden</button> 
                    <button id="resetfilter" class="filter-btn"> Filter zurücksetzen</button>   
                </li>
           </ul>
       </div>
       <a id="a1" download="graph.graphml"> Export result</a>         
        <h3 id="searchquery" class="center"> Sie suchen nach: ....</h3>
        <br>
            <div id="dataviz_basicZoom" class="center">
        </div>
        <script src="https://d3js.org/d3.v4.min.js"></script>
        <p>
            <h2 class="center" id="nresults">Resultate:</h2> 
            
        </p>
        
        <br>
        <ul id="output"></ul>
    </body>
    </html>
    <script src="https://code.jquery.com/jquery-latest.min.js"></script>
    <script src="/src/script.js"></script>
    <script src="/src/xml2json.js"></script>
    <script>
    let button = document.getElementById("filter-button");
    let container = document.getElementById("filter-container");
    let input = document.querySelectorAll("input");

    //Erstelle ein Eventlistener für eine Taste (gedrückt)
    window.onkeyup = keyup;

    function keyup(e) {
    //listens for you to press the ENTER key, at which point your web address will change to the one you have input in the search box
    if (e.keyCode == 13) {
        console.log();
        let res = search();
        console.log("Result: ", res);
        }
    }

    //Filter funktionen
    button.onclick = function (e) {
        e.stopPropagation();
        if (container.classList.contains("filters--active")) {
        container.classList.remove("filters--active");
        } else {
        container.classList.add("filters--active");
        }
    };

    container.onclick = function (e) {
        e.stopPropagation();
    };

    window.onclick = function () {
        container.classList.remove("filters--active");
    };

    console.log(input);

    for (var i = 0; i < input.length; i++) {
        var currentInput = input[i];

        currentInput.onclick = function () {
        var isChecked = false;
        for (var j = 0; j < input.length; j++) {
            if (input[j].checked) {
            isChecked = true;
            break;
            }
        }

        if (isChecked) {
            button.classList.add("button--highlight");
        } else {
            button.classList.remove("button--highlight");
        }
        };
    }


    function dateiauswahl(evt) {
    // FileList-Objekt des input-Elements auslesen, auf dem 
    // das change-Event ausgelöst wurde (event.target)
    let files = evt.target.files; 

    // Deklarierung eines Array Objekts mit Namen "fragmente". Hier werden die Bausteine
    // für die erzeugte Listenausgabe gesammelt.
    let fragmente = [];
    // Zählschleife; bei jedem Durchgang den Namen, Typ und 
    // die Dateigröße der ausgewählten Dateien zum Array hinzufügen
    for (var i = 0, f; f = files[i]; i++) {
        fragmente.push('<li><strong>', f.name, '</strong> (', f.type || 'n/a', ') - ',
                    f.size, ' bytes</li>');
    }
        // Alle Fragmente im fragmente Array aneinanderhängen, in eine unsortierte Liste einbetten
        // und das alles als HTML-Inhalt in das output-Elements mit id='dateiListe' einsetzen.
        document.getElementById('dateiListe').innerHTML = '<ul>' + fragmente.join('') + '</ul>';
    }

    // UI-Events erst registrieren wenn das DOM bereit ist!
    document.addEventListener("DOMContentLoaded", function() {
        // Falls neue Eingabe, neuer Aufruf der Auswahlfunktion
        document.getElementById('dateien').addEventListener('change', dateiauswahl, false);
    });
  
    
</script>
